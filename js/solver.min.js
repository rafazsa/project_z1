const button_calcular=document.querySelector("button"),load_file=document.querySelector("input#excel"),button_salvar=document.querySelector("#salvar");function execSolve(e,o){const a=window.solver,t=document.querySelector("input[name='cao_a']").value,l=document.querySelector("input[name='mgo_a']").value,r=document.querySelector("input[name='cao_b']").value,n=document.querySelector("input[name='mgo_b']").value;model={optimize:{aplicar_a:"max",aplicar_b:"max"},opType:"max",constraints:{alvo_mgo:{equal:o},alvo_cao:{equal:e}},variables:{aplicar_a:{aplicar_a:1,alvo_cao:t,alvo_mgo:l},aplicar_b:{aplicar_b:1,alvo_cao:r,alvo_mgo:n}}};const c=a.Solve(model),{feasible:i}=c.midpoint;let u=0,s=0;return i?(u=c.midpoint.aplicar_a,s=c.midpoint.aplicar_b):(u=c.ranges.aplicar_a.min,s=c.ranges.aplicar_b.min),{feasible:i,a:u,b:s,alvo_cao:u*t+s*r,alvo_mgo:u*l+s*n}}function updateAll(){const e=document.querySelector("input[name='cao_a']"),o=document.querySelector("input[name='cao_b']"),a=document.querySelector("input[name='mgo_a']"),t=document.querySelector("input[name='mgo_b']"),l=document.querySelector('input[name="ca_a"]'),r=document.querySelector('input[name="mg_a"]'),n=document.querySelector('input[name="prnt_a"]'),c=document.querySelector('input[name="acrescimo_ca_a"]'),i=document.querySelector('input[name="acrescimo_mg_a"]'),u=document.querySelector('input[name="pn_a"]'),s=document.querySelector('input[name="ca_b"]'),m=document.querySelector('input[name="mg_b"]'),d=document.querySelector('input[name="prnt_b"]'),p=document.querySelector('input[name="acrescimo_ca_b"]'),_=document.querySelector('input[name="acrescimo_mg_b"]'),v=document.querySelector('input[name="pn_b"]'),b=document.querySelector("#funcao_ca"),w=document.querySelector("#funcao_mg"),S=parseFloat(b.value)||1.784799244,y=parseFloat(w.value)||2.483274779,g=parseFloat(l.value)/100||.32,x=parseFloat(r.value)/100||.14,F=parseFloat(s.value)/100||.45,q=parseFloat(m.value)/100||.035,C={Ca:g,Mg:x,PRNT:parseFloat(n.value)/100||.85,acrescimoCa:g*S,acrescimoMg:x*y,PN:g*S+x*y},T={Ca:F,Mg:q,PRNT:parseFloat(d.value)/100||.85,acrescimoCa:F*S,acrescimoMg:q*y,PN:F*S+q*y},f=C.PRNT/C.PN*C.acrescimoCa,h=C.PRNT/C.PN*C.acrescimoMg,M=T.PRNT/T.PN*T.acrescimoCa,L=T.PRNT/T.PN*T.acrescimoMg;return b.value=S,w.value=y,e.value=f.toFixed(2),o.value=M.toFixed(2),a.value=h.toFixed(2),t.value=L.toFixed(2),l.value=(100*C.Ca).toFixed(2),r.value=(100*C.Mg).toFixed(2),n.value=(100*C.PRNT).toFixed(2),c.value=(100*C.acrescimoCa).toFixed(2),i.value=(100*C.acrescimoMg).toFixed(2),u.value=(100*C.PN).toFixed(2),s.value=(100*T.Ca).toFixed(2),m.value=(100*T.Mg).toFixed(2),d.value=(100*T.PRNT).toFixed(2),p.value=(100*T.acrescimoCa).toFixed(2),_.value=(100*T.acrescimoMg).toFixed(2),v.value=(100*T.PN).toFixed(2),{cao_a:f,mgo_a:h,cao_b:M,mgo_b:L}}function fillTable(e){const o=document.querySelector("#tbody_calc");for(let a=1;a<e.Planilha1.length;a++){let t=o.insertRow(-1);console.log(e.Planilha1[a][0]),t.insertCell(0).innerHTML=`<b>${e.Planilha1[a][0]}</b>`,t.insertCell(1).innerHTML=e.Planilha1[a][1].toFixed(2),t.insertCell(2).innerHTML=e.Planilha1[a][2].toFixed(2)}}function addSolverResults(){const e=document.querySelector("#tbody_calc").rows,o=[["Nome","A","B"]];for(row of e){row.cells.length>3&&(row.deleteCell(3),row.deleteCell(3),row.deleteCell(3),row.deleteCell(3),row.deleteCell(3),row.deleteCell(3),row.className="");const e=parseFloat(document.querySelector('input[name="prnt_a"]').value/100),a=parseFloat(document.querySelector('input[name="prnt_b"]').value/100),t=parseFloat(row.cells[1].innerHTML),l=parseFloat(row.cells[2].innerHTML),{a:r,b:n,alvo_cao:c,alvo_mgo:i,feasible:u}=execSolve(t,l);let s=r/e*1e3,m=n/a*1e3;o.push([row.cells[0].innerHTML.replace("<b>","").replace("</b>",""),s.toFixed(0),m.toFixed(0)]),u&&(row.className+=" feasible"),row.cells[1].innerHTML==c.toFixed(2)?row.insertCell().innerHTML=`<b>${c.toFixed(2)}</b>`:row.insertCell().innerHTML=c.toFixed(2),row.cells[2].innerHTML==i.toFixed(2)?row.insertCell().innerHTML=`<b>${i.toFixed(2)}</b>`:row.insertCell().innerHTML=i.toFixed(2),row.insertCell().innerHTML=`<b>${r.toFixed(4)}</b>`,row.insertCell().innerHTML=`<b>${n.toFixed(4)}</b>`,row.insertCell().innerHTML=s.toFixed(0),row.insertCell().innerHTML=m.toFixed(0)}localStorage.setItem("export",JSON.stringify(o)),document.querySelector("#salvar").removeAttribute("disabled")}function exportResults(){const e=window.XLSX.utils.book_new();e.Props={Title:"Limestone_Association",Subject:"Powered by Tsuyoshi Co.",Author:"Diego Tsuyoshi",CreatedDate:new Date};const o=JSON.parse(localStorage.getItem("export")),a=window.XLSX.utils.aoa_to_sheet(o);window.XLSX.utils.book_append_sheet(e,a,"Calc√°rio");const t=XLSX.write(e,{bookType:"xlsx",type:"binary"}),l=`LA_${(new Date).toLocaleDateString("pt-br",{hour:"2-digit",minute:"2-digit"}).replace(/\/|\:/g,"-").replace(" ","_")}`;window.saveAs(new Blob([function(e){const o=new ArrayBuffer(e.length),a=new Uint8Array(o);for(let o=0;o<e.length;o++)a[o]=255&e.charCodeAt(o);return o}(t)],{type:"application/octet-stream"}),`${l}.xlsx`)}updateAll(),document.querySelectorAll("input").forEach(e=>{e.onchange=(()=>updateAll())}),button_calcular.onclick=(()=>{addSolverResults()}),button_salvar.onclick=(()=>{exportResults()}),load_file.onchange=(e=>{const o=new window.FileReader;o.readAsArrayBuffer(e.target.files[0]),o.onload=function(e){const a=new window.Uint8Array(o.result),t=window.XLSX.read(a,{type:"array"});var l={};t.SheetNames.forEach(function(e){var o=window.XLSX.utils.sheet_to_json(t.Sheets[e],{header:1});o.length&&(l[e]=o)}),fillTable(l)}});